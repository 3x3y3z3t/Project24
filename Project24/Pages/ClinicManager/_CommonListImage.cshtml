@*  P24/_CommonListImage.cshtml
    *  Version: 1.1 (2022.12.13)
    *
    *  Contributor
    *      Arime-chan
*@

@using Project24.App
@model Project24.Models.ClinicManager.DataModel.P24ImageListingModel

@{
    bool hasImage = Model.Images != null && Model.Images.Count > 0;
}

<div>
    @if (Model.IsReadonly)
    {
        if (hasImage)
        {
            <h5 class="text-bold">Ảnh (@Model.Images.Count ảnh)</h5>
        }
    }
    else
    {
        if (hasImage)
        {
            <h5 class="text-bold">Ảnh (@Model.Images.Count ảnh) | <a href="#" data-toggle="collapse" data-target="#add-image-form">Thêm ảnh</a></h5>
        }
        else
        {
            <h5 class="text-bold"><a href="#" data-toggle="collapse" data-target="#add-image-form">Thêm ảnh</a></h5>
        }

        <div id="add-image-form" class="collapse">
            <form method="post" asp-page="Create" asp-page-handler="CreateImage" enctype="multipart/form-data" id="add-image-form" class="col-md-6" style="@ViewData["AddImgFormStyles"]">
                <hr />
                <div class="form-group" >
                    <input asp-for="_formData.OwnerCode" class="form-control" value="@Model.OwnerCode" readonly />
                    <span asp-validation-for="_formData.OwnerCode" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="_formData.UploadedFiles" class="control-label">Ảnh (nhiều file, tối đa 32 MB)</label>
                    <input asp-for="_formData.UploadedFiles" accept="image/*" class="form-control" />
                    <span asp-validation-for="_formData.UploadedFiles" class="text-danger"></span>
                </div>

                <hr />

                <button type="submit" class="btn btn-primary">Thêm</button>
                <button type="reset" data-toggle="collapse" data-target="#add-image-form" class="btn btn-secondary">Hủy bỏ</button>

                @Html.AntiForgeryToken()
            </form>
        </div>
        <hr />
    }

    @if (hasImage)
    {
        <div class="d-flex flex-wrap">
            @foreach (var image in Model.Images)
            {
                string path = "/" + image.Path + "/" + image.Name;
                string fullpath = "/data" + path;

                <figure class="figure m-2">
                    <img src="@fullpath" class="figure-img img-fluid" style="max-height:200px;" />
                    <figcaption class="figure-caption">@image.Name</figcaption>

                    @if (!Model.IsReadonly)
                    {
                        string func = "";
                        switch (@Model.Module)
                        {
                            case P24Module.Customer:
                                func = "customer_commonListImage_DeleteCustomerImage('" + image.Id + "')";
                                break;
                            case P24Module.Ticket:
                                func = "customer_commonListImage_DeleteTicketImage('" + image.Id + "')";
                                break;
                        }

                        <a href="#" onclick="@func">Xóa</a>
                    }

                </figure>
            }
        </div>
    }
</div>
