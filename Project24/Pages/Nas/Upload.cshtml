@*  Upload.cshtml
    *  Version: 1.5 (2022.10.22)
    *
    *  Contributor
    *      Arime-chan
*@

@page

@model Project24.Pages.Nas.UploadModel

@{
    ViewData["Title"] = "Upload";
    ViewData[CustomInfoKey.UseFullWidth] = "true";

    Layout = "_Layout";
}

<div class="d-flex flex-wrap">

    <div id="nas-browser" class="col-12 col-lg-6 col-xl-6 px-3 border-left">
        <h4>NAS Browser</h4>
        <hr />

    </div>

    <div class="col-12 col-lg-6 col-xl-6 px-3 border-left border-primary" style="border-left-width: thick;">
        <h4>NAS Upload</h4>
        <hr />

        <div class="mb-2">
            <div>Upload location: <span id="upload-location" class="font-italic" onmouseover="underlineMe(this)" onmouseout="normalizeMe(this)">root/</span></div>
            <p>Uploading: <span id="current-file-name" class="font-weight-bold">None</span></p>

            <div class="mb-2">
                <span id="current-progress-info">Current: None</span>
                <span id="current-progress-info-status" class="text-danger" style="display: inline;">(Paused)</span>

                <div id="current-progress-bar-wrapper" class="progress">
                    <div id="current-accepted-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="transition-duration: 0.1s;"
                         role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                    <div id="current-sent-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-warning" style="transition-duration: 0.1s;"
                         role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="mb-2">
                <span id="total-progress-info">Total: None</span>
                <span id="total-progress-info-status" class="text-danger" style="display: inline;">(Paused)</span>

                <div id="total-progress-bar-wrapper" class="progress">
                    <div id="total-accepted-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="transition-duration: 0.1s;"
                         role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                    <div id="total-sent-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-warning" style="transition-duration: 0.1s;"
                         role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="my-3">
                <button type="button" id="button-pause" class="btn btn-danger">Pause</button>
                <button type="button" id="button-resume" class="btn btn-info">Resume</button>
            </div>

        </div>
        <hr />

        <form id="upload-form">
            <label>File(s):</label>
            <input type="file" id="input-files" name="file" multiple />
            <br />

            <button type="button" id="button-upload" class="btn btn-success">Upload</button>
        </form>
        <hr />

        <p id="files-list-overview">Total: 0 file</p>
        <div id="files-list" class="ml-3">
        </div>

    </div>

</div>

@section Scripts {
<script src="~/js/nas-upload.js"></script>
<script src="~/lib/tus-js-client/tus.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        browseNas("");

    });

    function inputNewFolderName_OnChange() {
        if ($("#input-new-folder-name").val())
            $("#btn-create-folder").show();
        else
            $("#btn-create-folder").hide();
    }

    function createFolder() {
        let location = "root/" + $("#current-location").html();
        let folderName = $("#input-new-folder-name").val();

        let text = "Location: " + location + "\nNew Folder: '" + folderName + "'\n\nAre you sure you want to create this folder?"

        if (confirm(text) == true) {
            sendCreateFolderRequest(location.substring(5), folderName);
        } else {

        }
      }

      function sendCreateFolderRequest(_path, _folderName) {
          if (!_path.endsWith("/"))
          _path += "/";

          $.ajax({
            type: 'GET',
            url: '<createFolder>' + _path + _folderName,
            success: function(_content) {
                $("#nas-browser").html(_content);

                let newLocation = "root/" + $("#current-location").html();
                //window.alert(newLocation);
                $("#upload-location").html(newLocation);
            },
            error: function() {
                window.alert("Could not fetch browser.");
            }
        });
    }

    function browseNas(_path) {
        $.ajax({
            type: 'GET',
            url: '<upload>' + _path,
            success: function(_content) {
                $("#nas-browser").html(_content);

                let newLocation = "root/" + $("#current-location").html();
                //window.alert(newLocation);
                $("#upload-location").html(newLocation);
            },
            error: function() {
                window.alert("Could not fetch browser.");
            }
        });
    }

    function underlineMe(_x) {
        _x.style.textDecoration = "underline";
    }

    function normalizeMe(_x) {
        _x.style.textDecoration = "initial";
    }
</script>
}
